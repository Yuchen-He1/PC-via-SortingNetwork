# FPGA 部署指南 - FA-based 并行计数器 (Nexys A7-100T)

这个文件夹包含将 `pc_fa_7_3` 全加器基础并行计数器部署到 Nexys A7-100T FPGA 开发板的文件。

## 📁 文件说明

- `pc_fa_7_3_top.v` - FA-based 并行计数器 FPGA 顶层模块
- `../constraints/pc_fa_7_3_nexys_a7_100t.xdc` - 约束文件（引脚映射）
- `README_FA_based.md` - 这个说明文件

## 🔌 引脚映射

### 输入 (开关)
- `d[0]` ← SW0 (开关0)
- `d[1]` ← SW1 (开关1)  
- `d[2]` ← SW2 (开关2)
- `d[3]` ← SW3 (开关3)
- `d[4]` ← SW4 (开关4)
- `d[5]` ← SW5 (开关5)
- `d[6]` ← SW6 (开关6)

### 输出 (LED)
- `count_out[0]` → LD0 (LED0 - 最低位)
- `count_out[1]` → LD1 (LED1 - 中间位)
- `count_out[2]` → LD2 (LED2 - 最高位)

## 🏗️ 设计架构

FA-based 并行计数器使用全加器 (Full Adder) 构建：
- **fa0**: 处理 d[2:0] (前3位)
- **fa1**: 处理 d[5:3] (中间3位)  
- **fa2**: 合并 fa0、fa1 的和与 d[6]
- **fa3**: 合并所有进位产生最终输出

## 🚀 Vivado 部署步骤

### 1. 创建新项目
```
File → New Project → Next
Project Name: pc_fa_7_3_fpga
Project Location: 选择你的工作目录
Project Type: RTL Project
```

### 2. 添加源文件
在 Vivado 中添加以下文件：
```
- fpga/pc_fa_7_3_top.v (FA-based 顶层模块)
- parallel_counters/fa_based/pc_fa_7_3.v
- parallel_counters/common/full_adder.v
```

### 3. 添加约束文件
```
添加 constraints/pc_fa_7_3_nexys_a7_100t.xdc
```

### 4. 选择目标器件
```
Parts: xc7a100tcsg324-1 (Nexys A7-100T)
```

### 5. 设置顶层模块
```
设置 pc_fa_7_3_top 为顶层模块
```

### 6. 综合和实现
```
Run Synthesis → Run Implementation → Generate Bitstream
```

### 7. 编程 FPGA
```
Open Hardware Manager → Connect to board → Program Device
```

## 🧪 测试方法

### 基本功能测试
1. **零输入测试**：
   - 所有开关向下 (0000000) → LED 显示 000 (0个1)

2. **单一输入测试**：
   - SW0向上 (0000001) → LED 显示 001 (1个1)
   - SW1向上 (0000010) → LED 显示 001 (1个1)

3. **多输入测试**：
   - SW0,SW1向上 (0000011) → LED 显示 010 (2个1)
   - SW0,SW1,SW2向上 (0000111) → LED 显示 011 (3个1)

### 验证全加器级联
4. **级联测试**：
   - 测试各个全加器的工作：
   - fa0: d[2:0] = 111 → 应该产生 sum=1, carry=1
   - fa1: d[5:3] = 111 → 应该产生 sum=1, carry=1  
   - fa2: 合并两个和与d[6]
   - fa3: 合并所有进位

## 📊 测试示例

| 开关状态 (SW6-SW0) | 十进制 | 1的个数 | LED输出 (LD2-LD0) | 说明 |
|-------------------|-------|--------|-------------------|------|
| 0000000          | 0     | 0      | 000               | 全零 |
| 0000001          | 1     | 1      | 001               | 单位 |
| 0000011          | 3     | 2      | 010               | 两位 |
| 0000111          | 7     | 3      | 011               | 三位 |
| 0001111          | 15    | 4      | 100               | 四位 |
| 0011111          | 31    | 5      | 101               | 五位 |
| 0111111          | 63    | 6      | 110               | 六位 |
| 1111111          | 127   | 7      | 111               | 全一 |
| 1010101          | 85    | 4      | 100               | 交替 |

## 🔍 与 SN-based 版本的区别

| 特性 | FA-based | SN-based |
|------|----------|----------|
| **基本单元** | 全加器 (Full Adder) | 排序网络 + 2-sorter |
| **层次结构** | 4个全加器级联 | 排序器 + 计数器逻辑 |
| **端口名** | `d[6:0]`, `count_out[2:0]` | `in[6:0]`, `out[2:0]` |
| **依赖文件** | `full_adder.v` | `7-sorter.v` |
| **复杂度** | 相对简单，直接计数 | 更复杂，先排序后计数 |

## ⚠️ 注意事项

1. **端口匹配**: FA-based 版本使用 `d` 和 `count_out` 端口名
2. **依赖文件**: 确保包含 `full_adder.v` 而不是排序网络文件
3. **约束文件**: 使用专门的 `pc_fa_7_3_nexys_a7_100t.xdc`
4. **功能验证**: 两个版本功能相同，但内部实现不同

## 🔧 故障排除

- **综合错误**: 检查是否包含 `full_adder.v` 文件
- **端口错误**: 确认约束文件中的端口名与顶层模块匹配
- **功能错误**: 对比 FA-based 和 SN-based 版本的输出
- **时序问题**: FA-based 版本应该有更好的时序特性

## 🏆 性能对比

FA-based 并行计数器的优势：
- **更直接的实现**: 使用经典的全加器树结构
- **更好的时序**: 减少逻辑层次
- **更易理解**: 传统的加法器级联方式
- **资源效率**: 可能使用更少的 LUT 资源 